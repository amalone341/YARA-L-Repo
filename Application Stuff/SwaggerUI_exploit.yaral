rule Swagger_exploit_attempt {

  meta:
    // https://www.vidocsecurity.com/blog/hacking-swagger-ui-from-xss-to-account-takeovers/#where-is-the-bug-and-how-does-it-work
    // License: https://github.com/amalone341/YARA-L-Work/blob/main/LICENSE
    author = "Andy Malone"
    status = "Testing"
    description = "Look for malicious URLs accoviated with the swagger vulnerability"
    severity = "Medium"
    

  events:
    // Going off URL field here, there are some valid cases but look for logs that have a request that looks like:
    // ?url=https://your_api_spec/spec.yaml or ? configUrl=https://your_api_spec/file.json

    $e.target.url = /.*swagger.*\?configUrl=.*/ nocase or
    $e.target.url = /.*swagger.*\?url=.*/ nocase
    $e.security_result.action != "BLOCK"

  condition:
    $e
}
