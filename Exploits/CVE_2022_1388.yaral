rule F5_CVE_2022_1388 {

  meta:
    // Going off the POC here https://github.com/horizon3ai/CVE-2022-1388/blob/main/CVE-2022-1388.py
    // License: https://github.com/amalone341/YARA-L-Work/blob/main/LICENSE
    author = "Andy Malone"
    status = "Experimental"
    description = "Look for expoitation of cve 2022 1388"
    severity = "CRITICAL"

  events:
    //  currently the rule is looking for an incoming exploit attempt followed by some form of 
    //  communication with the IP that attempted the exploit. 
    //
    // To just see attempts use the inbound event variable only
    $inbound.principal.ip = $offender_ip
    $inbound.principal.ip = $pip
    $inbound.target.url = /.*mgmt\/tm\/util\/bash.*/ nocase // string indicative of the exploit
    $inbound.network.http.method = "POST"

    $outbound.target.ip = $offender_ip



  match:
      $pip over 10m after $inbound

  condition:
    $inbound and $outbound
}
